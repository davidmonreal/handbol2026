# Repository Guidelines

## Project Structure & Module Organization

- Source code: `src/` (entry: `src/app.ts`), shared types in `src/types/`.
- Build output: `dist/` (generated by `tsc`).
- Config: `tsconfig.json`, package scripts in `package.json`.
- Tests: not yet configured; prefer `tests/` with `*.spec.ts`.

## Build, Test, and Development Commands

- Install dependencies: `npm ci` (or `npm install` for local development).
- Build TypeScript: `npm run build` (emits to `dist/`).
- Run compiled app: `npm start` (executes `node dist/app.js`).
- Quick dev run (no build): `npx ts-node src/app.ts`.
- Tests: `npm test` currently a placeholder; see Testing Guidelines to add real tests.

## Coding Style & Naming Conventions

- TypeScript strict mode enabled; favor explicit types at module boundaries.
- Indentation: 2 spaces; include semicolons; single quotes or consistent style.
- Naming: `camelCase` for variables/functions, `PascalCase` for types/classes, `UPPER_SNAKE_CASE` for constants.
- File names: `kebab-case.ts` (e.g., `user-service.ts`); index files allowed for small barrels.
- Imports: relative within `src/`; avoid deep relative chains by reorganizing modules rather than path aliases.

## Engineering Principles

- Follow SOLID principles; keep modules small, cohesive, and loosely coupled.
- Prefer established design patterns where they clarify intent (e.g., Strategy, Factory, Dependency Injection).
- All new code must include unit tests; update or add tests when modifying behavior.
- Verify all new features are covered by tests.
- Do not accept a feature as complete until all tests pass.

## Testing Guidelines

- Suggested stack: Vitest or Jest with `ts-jest`/ESM support.
- Location: place tests under `tests/` mirroring `src/` structure; name as `*.spec.ts`.
- Coverage: target 80%+ lines/branches for new or modified code.
- Commands example: add `"test": "vitest"`, `"test:watch": "vitest --watch"` to `package.json`.

## Commit & Pull Request Guidelines

- Use Conventional Commits: `feat:`, `fix:`, `docs:`, `chore:`, `refactor:`, `test:`, `build:`.
- Limit subject to ~72 chars; include a concise body explaining rationale and impacts.
- PRs must include: clear description, linked issue (if any), before/after notes, and steps to verify (commands, endpoints).
- Keep PRs focused and small; include updates to docs/tests for changed behavior.

## Security & Configuration

- Configuration via env vars (e.g., `PORT`). Use a local `.env` and never commit secrets.
- Node 18+ recommended. Run `npm ci` for reproducible installs.
- Ignore generated artifacts in VCS (`dist/`, logs). Keep `src/` the single source of truth.

## Issue Templates & Follow-Up

- Templates:
  - Supertest: `.github/ISSUE_TEMPLATE/millora-supertest.md`
  - Husky + lint-staged: `.github/ISSUE_TEMPLATE/millora-husky-lint-staged.md`
- Use: on GitHub, New issue → tria la plantilla, assigna responsable, ajusta criteris d’acceptació.
- PRs: vincula l’issue al PR (`Closes #<num>`), afegeix passos de verificació i mantén l’abast petit.
- Tancament: el PR ha de tancar l’issue automàticament; actualitza aquesta guia si el flux canvia.

## GameEvent Zone Derivation

The `GameEvent` model includes a canonical `zone` field that is derived and persisted by the backend at create/update time. This ensures consistent zone representation across the application:

- **7m (Penalty)**: events with `distance: '7M'` → `zone: '7m'` (position is intentionally omitted).
- **6m Line**: events with `distance: '6M'` + position (e.g., LW, CB) → `zone: '6m-LW'`, `zone: '6m-CB'`, etc.
- **9m Line**: events with `distance: '9M'` + position → `zone: '9m-LB'`, `zone: '9m-RB'`, etc.

**Backend Implementation** (in `repositories/game-event-repository.ts`):

- The `create()` and `update()` methods derive `zone` based on `position` and `distance` fields before persisting.
- Special case: 7m penalties have `distance = '7M'` and `position = null` → they correctly yield `zone = '7m'`.

**Frontend Usage** (in `utils/eventTransformers.ts`):

- Backend now provides the canonical `zone` on all `GameEvent` responses.
- Frontend uses `zone` directly; client-side derivation is a fallback for backward compatibility only.

**Testing**: See `tests/game-event-zone.test.ts` for zone derivation tests including 7m penalties, zone updates on field changes, and null handling.
