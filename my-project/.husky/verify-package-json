#!/usr/bin/env sh

# Check if package.json is being modified to add dangerous flags
if git diff --cached --name-only | grep -q "package.json"; then
  # Check if the diff contains dangerous patterns
  if git diff --cached package.json | grep -i "accept-data-loss"; then
    echo ""
    echo "ğŸš¨ CRITICAL ERROR: Attempting to add '--accept-data-loss' flag!"
    echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
    echo "This flag DELETES DATA on every deployment!"
    echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
    echo ""
    echo "NEVER use --accept-data-loss in production scripts!"
    echo ""
    echo "âŒ COMMIT BLOCKED"
    echo ""
    exit 1
  fi
  
  # General warning for package.json changes
  echo ""
  echo "âš ï¸  WARNING: You are modifying package.json"
  echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
  echo "This file contains build scripts for deployment."
  echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
  echo ""
  echo "Continue with commit? (y/n)"
  exec < /dev/tty
  read -r response
  if [ "$response" != "y" ] && [ "$response" != "Y" ]; then
    echo ""
    echo "âŒ Commit aborted by user."
    echo ""
    exit 1
  fi
  echo ""
  echo "âœ… Proceeding with commit..."
  echo ""
fi
