generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Club {
  id    String @id @default(uuid())
  name  String
  teams Team[]
}

model Season {
  id        String   @id @default(uuid())
  name      String
  startDate DateTime
  endDate   DateTime
  teams     Team[]
}

model Team {
  id          String             @id @default(uuid())
  name        String
  category    String             @default("SENIOR")
  isMyTeam    Boolean            @default(false)
  clubId      String
  seasonId    String
  awayMatches Match[]            @relation("AwayTeam")
  homeMatches Match[]            @relation("HomeTeam")
  players     PlayerTeamSeason[]
  club        Club               @relation(fields: [clubId], references: [id])
  season      Season             @relation(fields: [seasonId], references: [id])
}

model Player {
  id                     String             @id @default(uuid())
  name                   String
  number                 Int
  handedness             Handedness         @default(RIGHT)
  isGoalkeeper           Boolean            @default(false)
  activeGoalkeeperEvents GameEvent[]        @relation("ActiveGoalkeeper")
  events                 GameEvent[]        @relation("EventPlayer")
  teams                  PlayerTeamSeason[]
}

model PlayerTeamSeason {
  id       String @id @default(uuid())
  playerId String
  teamId   String
  role     String
  player   Player @relation(fields: [playerId], references: [id], onDelete: Cascade)
  team     Team   @relation(fields: [teamId], references: [id], onDelete: Cascade)

  @@unique([playerId, teamId])
}

model Match {
  id         String      @id @default(uuid())
  date       DateTime
  homeTeamId String
  awayTeamId String
  isFinished Boolean     @default(false)
  homeScore  Int         @default(0)
  awayScore  Int         @default(0)
  events     GameEvent[]
  awayTeam   Team        @relation("AwayTeam", fields: [awayTeamId], references: [id])
  homeTeam   Team        @relation("HomeTeam", fields: [homeTeamId], references: [id])
}

model GameEvent {
  id                 String  @id @default(uuid())
  matchId            String
  timestamp          Int
  playerId           String?
  teamId             String
  type               String
  subtype            String?
  position           String?
  distance           String?
  isCollective       Boolean @default(false)
  hasOpposition      Boolean @default(true)
  isCounterAttack    Boolean @default(false)
  goalZone           String?
  sanctionType       String?
  activeGoalkeeperId String?
  activeGoalkeeper   Player? @relation("ActiveGoalkeeper", fields: [activeGoalkeeperId], references: [id])
  match              Match   @relation(fields: [matchId], references: [id])
  player             Player? @relation("EventPlayer", fields: [playerId], references: [id])
}

enum Handedness {
  LEFT
  RIGHT
}
